# Capability: Authentication (Extended)

为用户认证能力添加邮箱验证码注册功能。

## ADDED Requirements

### Requirement: 带邮箱验证的注册流程

系统 SHALL 提供基于邮箱验证码的注册流程,确保用户拥有邮箱访问权限。

#### Scenario: 验证码注册流程

- **GIVEN** 用户需要注册新账号
- **WHEN** 用户完成以下步骤:
  1. 获取图形验证码
  2. 使用图形验证码请求发送邮箱验证码
  3. 查收邮件获取6位数字验证码
  4. 提交邮箱、密码和邮箱验证码完成注册
- **THEN** 系统验证邮箱验证码的有效性
- **AND** 验证成功后创建账号(状态为 active)
- **AND** 返回用户信息和访问令牌

#### Scenario: 邮箱验证码无效

- **GIVEN** 用户提供错误的邮箱验证码
- **WHEN** 用户提交注册请求
- **THEN** 系统返回 400 错误
- **AND** 提示验证码无效或已过期

#### Scenario: 超过验证尝试次数

- **GIVEN** 用户已失败验证5次
- **WHEN** 用户再次尝试注册
- **THEN** 系统返回 429 错误
- **AND** 提示验证码已失效,需重新获取
