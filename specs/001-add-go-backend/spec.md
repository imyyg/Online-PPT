# Feature Specification: 用户登录与PPT记录服务

**Feature Branch**: `001-add-go-backend`  
**Created**: 2025-11-04  
**Status**: Draft  
**Input**: 用户需求："需要登录功能，暂时可以仅实现邮箱注册登录即可；记录用户创建的ppt，能通过记录快速定位到ppt所在文件夹。"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 邮箱注册登录 (Priority: P1)

作为首次使用者，我希望通过邮箱注册账号并登录系统，以便安全地管理自己的演示资源。

**Why this priority**: 没有账户体系无法区分用户及其资源归属，是后端最核心的基础能力。

**Independent Test**: 通过API完成注册、登录、退出流程并验证会话状态，即可独立验收。

**Acceptance Scenarios**:

1. **Given** 新用户提供合法邮箱和密码，**When** 提交注册请求，**Then** 系统创建账号并返回注册成功反馈。
2. **Given** 用户账号已存在且凭证正确，**When** 发起登录，**Then** 系统建立会话并返回授权信息；凭证错误时返回明确的失败原因。

---

### User Story 2 - 记录用户PPT (Priority: P2)

作为创作者，我希望系统记录我创建的PPT条目（含名称、说明、所在文件夹路径），并按照我的用户标识和演示名称建立目录，以便日后快速定位和进入对应目录进行编辑或展示。

**Why this priority**: 记录能力直接支撑登录用户管理内容，是登录后的首个高价值功能，但依赖用户身份信息，因此排在P2。

**Independent Test**: 登录后创建、查询、删除个人PPT记录并验证路径指向正确目录，即可独立完成测试。

**Acceptance Scenarios**:

1. **Given** 用户已登录并提供合规的演示名称（字母、数字、下划线或中划线），**When** 创建记录，**Then** 系统在 `presentations/<user-uuid>/<group>/slides` 下建立目录并返回唯一标识与时间戳。
2. **Given** 用户拥有多条记录，**When** 请求列表，**Then** 按创建时间或自定义排序返回，并包含可用于定位文件夹的完整路径信息。

---

### User Story 3 - 管理个人列表 (Priority: P3)

作为回访用户，我希望能够查看、搜索和更新自己已经记录的PPT条目，以保持信息准确并快速进入需要的内容。

**Why this priority**: 列表管理提升长期可用性，但在注册、记录功能稳定后再交付不会阻塞首版上线。

**Independent Test**: 登录后对记录执行查询、模糊搜索、更新描述及删除操作，验证权限控制与反馈信息。

**Acceptance Scenarios**:

1. **Given** 用户拥有数十条记录，**When** 通过名称或标签搜索，**Then** 返回匹配条目并保持分页或限制数量可控。
2. **Given** 用户更新记录所指向的目录，**When** 提交修改，**Then** 系统校验目录存在且属于允许范围，再确认修改成功。


### Edge Cases

- 当邮箱已被注册时，注册流程必须返回冲突提示而非覆盖原记录。
- 当用户输入无效邮箱格式或密码不符合安全策略时，需即时反馈并阻止账户创建。
- 当记录的PPT路径不符合 `presentations/<user-uuid>/<group>/slides` 模式或目录不存在时，系统需拒绝保存并提示原因。
- 当用户尝试访问他人记录或未登录直接操作时，系统必须返回未授权错误并记录行为。
- 当PPT目录被移动或删除后，读取记录时需返回可辨识的异常状态并提示用户修复。

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统必须提供邮箱注册接口，校验邮箱唯一性与密码规则，并返回明确的成功或失败信息。
- **FR-002**: 系统必须提供邮箱登录接口，验证凭证并建立可在前端维持的会话或令牌，支持注销操作。
- **FR-003**: 系统必须提供创建PPT记录的接口，接受名称（字母、数字、下划线、中划线）作为目录名及显示名称、描述等字段，并关联当前登录用户。
- **FR-004**: 系统必须提供查询与筛选PPT记录的接口，支持按时间、名称或标签排序，且仅返回属于当前用户的数据。
- **FR-005**: 系统必须支持更新与删除PPT记录，确保只有记录创建者可以修改或移除对应条目。
- **FR-006**: 系统必须在保存记录前基于用户UUID构建 `presentations/<user-uuid>/<group>/slides` 目录结构，校验目录存在且可写，并存储可直接定位的完整路径信息。
- **FR-007**: 系统必须对注册、登录、记录操作的失败情况进行日志记录，包含时间与错误原因，便于追踪与审计。

### Principle Alignment

- **P1 Slide Files**: PPT记录仅存储路径引用，不修改实际HTML文件，保持幻灯片的独立制作与存放模式。
- **P2 Config Sync**: 用户记录中的路径需与新约定的 `presentations/<user-uuid>/<group>/slides` 结构及 `slides.config.json` 信息保持一致，避免出现前端找不到的内容。
- **P3 Frontend Discipline**: 新增的认证与记录数据需符合现有前端组件的使用方式，响应格式应保持简洁一致，避免引入不必要的前端改造。
- **P4 UX Baseline**: 后端需提供完整的演示元信息（如标题、标签）以支持前端呈现和快捷导航，确保登录流程不会破坏既有演示体验。

### Key Entities *(include if feature involves data)*

- **UserAccount**: 表示注册用户，包含邮箱、密码摘要、安全标记、状态以及最近一次登录时间。
- **UserSession**: 表示用户登录状态，包含会话标识、有效期、关联用户和创建来源。
- **PptRecord**: 表示用户创建的PPT记录，包含名称、描述、目录路径（遵循 `presentations/<user-uuid>/<group>/slides`）、标签、创建与更新时间，关联`UserAccount`。
- **PptLocation**: 表示路径校验结果，包含物理路径、路径模式状态等辅助信息，为`PptRecord`提供定位能力。

## Assumptions

- 用户密码策略采用常见的最小长度与复杂度要求，短期内无需邮箱验证码或多因素认证。
- 后端使用 MySQL 8.x 提供数据存储，所有主键为自增 INT，账户额外持久化 UUID 字段。
- PPT路径固定为 `presentations/<user-uuid>/<group>/slides`，其中 `<user-uuid>` 来源于账户字段，`<group>` 为合规演示名称。
- 当前阶段主要支持个人用途，不涉及团队协作或跨用户共享记录；后续如需共享将另行立项。
- 前端通过统一API访问后端获取登录状态与PPT记录，不直接读取文件系统。

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 注册与登录流程在95%的请求中响应时间不超过700ms（本地部署环境），且失败率低于2%。
- **SC-002**: 用户创建PPT记录后，前端能够在5秒内定位并打开对应目录，错误率低于1%。
- **SC-003**: 登录用户能够在单次请求中获取其全部记录，若记录超过100条需在3秒内返回分页或限制结果。
- **SC-004**: 功能上线后，至少90%的测试用户反馈能通过账户管理快速找到目标PPT目录。
